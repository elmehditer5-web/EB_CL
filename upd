# Always make sure id_pm is a column on the right side
right_df = data_frame
if 'id_pm' not in right_df.columns:
    # Bring index back as a column (handles single or MultiIndex)
    right_df = right_df.reset_index()

# Keep only columns not already in data_fin, plus the join key
cols_to_add = [c for c in right_df.columns if c not in data_fin.columns or c == 'id_pm']
right_df = right_df.loc[:, cols_to_add]

# Optional: de-duplicate any repeated column names just in case
right_df = right_df.loc[:, ~right_df.columns.duplicated()]

# Safe merge on column key
merged_data = data_fin.merge(right_df, on='id_pm', how='left')

